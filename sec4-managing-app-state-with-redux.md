# Section 4: Managing App State with Redux

## List of Books App Prototype
![](https://raw.githubusercontent.com/floydchenchen/pictures/master/Screen%20Shot%202018-04-13%20at%209.44.43%20AM.png)
![](https://raw.githubusercontent.com/floydchenchen/pictures/master/Screen%20Shot%202018-04-13%20at%209.45.36%20AM.png)

## Reducer
* reducer: a function that returns a piece of the application state
* for the list of books app, a reducer for list of books; another reducer for currently selected books
* reducers produce the value of our state.

![](https://raw.githubusercontent.com/floydchenchen/pictures/master/Screen%20Shot%202018-04-13%20at%201.37.18%20PM.png)


### using a reducer
* create a reducer
* wire it into our application

## Container: Connecting Redux to React
* container: a component that has direct access to the state produced by redux
* react-redux: form a bridge between redux library and react library
![](https://raw.githubusercontent.com/floydchenchen/pictures/master/Screen%20Shot%202018-04-13%20at%202.04.15%20PM.png)

* app: dumb component: dumb component (no connection to redux)
* book list & book detail: smart component (connected to redux)

### connect function

```JavaScript
import React, { Component } from 'react';
import { connect } from 'react-redux';


class BookList extends Component {

    renderList() {
        return this.props.books.map((book) => {
            return (
                <li className="list-group-item">{book.title}</li>
            );
        });
    }

    render() {
        return (
            <ul className="list-group col-sm-4">
                {this.renderList()}
            </ul>
        )
    }
}

// take application state as an argument (that contains a book list and an active book)
// connection between state(redux) and our component(container)
function mapStateToProps(state) {
    // whatever is returned will show up as props inside of bookList
    return {
        books: state.books
    };
}

// connect takes a function and a component and produces a container
export default connect(mapStateToProps)(BookList);
```

* if the state is changed, the container will instantly re-render a new list of books

## Review of Redux and Container
* **redux** serves to construct the application **state** and **react** provides the **views** to display that state
* redux and react libraries are **inherently disconnected**; and only through the use of **react-redux** can we get a connection between them.
* application states are generated by **reducer functions**.
* combine reducers through `combineReducers`

###### reducers/index.js

```JavaScript
import { combineReducers } from 'redux';
import BooksReducer from './reducer_books';
const rootReducer = combineReducers({
  books: BooksReducer
});

export default rootReducer;
```
* create a component and promote booklist to the container by using `mapStateToProps()` and `connect()`

###### containers/book-list.js
```JavaScript
export default connect(mapStateToProps)(BookList);
```

* make sure that `app.js` renders the booklist by importing the booklist and returning the `<BookList />` tag.
* every time the state is updated, the component re-render the list of books.

## Action and Action Creators
###### the lifecycle of an action in a redux application (when an user clicks on a book)
![](https://raw.githubusercontent.com/floydchenchen/pictures/master/Screen%20Shot%202018-04-13%20at%202.43.55%20PM.png)

## Binding Action Creators
* Turns an object whose values are action creators, into an object with the same keys, but with every action creator wrapped into a dispatch call so they may be invoked directly.
* The only use case for `bindActionCreators` is when you want to pass some action creators down to a component that isn't aware of Redux, and you don't want to pass dispatch or the Redux store to it.

###### containers/book-list.js

```
class BookList extends Component {

    renderList() {
        return this.props.books.map((book) => {
            return (
                // call the bind action creator
                <li key={book.title}
                    onClick={() => this.props.selectBook(book)}
                    className="list-group-item">
                    {book.title}
                </li>
            );
        });
    }

    render() {
        return (
            <ul className="list-group col-sm-4">
                {this.renderList()}
            </ul>
        )
    }
}
```

## Consuming Actions in Reducers

###### reducers/reducer_active_book.js

```JavaScript
// state argument is not application state, but only the state this reducer is responsible for
export default function (state = null, action) {
    switch (action.type) {
        case 'BOOK_SELECTED':
            return action.payload;
        // default:
        //     return state;
    }
    return state;
}
```
Use a container to render a component (Use a container to render active book component)

###### containers/book-detail.js

```
import React, { Component } from 'react';
import { connect } from 'react-redux';


export default class BookDetail extends Component {
    render() {
        return (
            <div>Book detail</div>
        );
    }
}

function mapStateToProps(state) {
    return {
        book: state.activeBook
    };
}

export default connect(mapStateToProps)(BookDetail);
```

## Conditional Rendering

###### containers/book-detail.js

```
class BookDetail extends Component {
    render() {
        if (!this.props.book) {
            return <div><h3>Select a book to get started!</h3></div>
        }
        return (
            <div>
                <h3>Detail for: </h3>
                <div>Title: { this.props.book.title }</div>
                <div>Pages: { this.props.book.pages }</div>
            </div>
        );
    }
}
```

## Summary

### Redux's state management flow
![](https://www.sohamkamani.com/assets/images/posts/react-redux-explanation/redux-flow.svg)

* Only accessing from top and bottom of the flow chart
    * setter: **dispatch** an action to change the state
    * getter: get the **state** by getState()

### connect
![](https://www.sohamkamani.com/assets/images/posts/react-redux-explanation/final-connect-flow.svg)

* map the stores state and dispatch to the props of a component: similar to adding a getter and setter to a component.

### schematic diagram
![](https://raw.githubusercontent.com/floydchenchen/pictures/master/Screen%20Shot%202018-04-19%20at%201.02.23%20AM.png)

